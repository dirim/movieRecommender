<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml" layout:decorator="layout">
<th:block layout:fragment="content">

    <div class="ui divided items">

        <div class="item">
            <div class="content movieDetail">
                <input type="hidden" name="id" th:value="${movie.id}"/>

                <a class="header" th:text="${movie.movieName}"></a>
                <div class="description">
                    <p th:text="${movie.catName}"></p>
                    <p th:text="${movie.year}"></p>
                    <p id="imdbRate" th:text="${movie.imdbRate}"></p>
                    <p id="rate" th:if="${movie.avgRate} > 0" th:text="${#numbers.formatDecimal(movie.avgRate, 1, 1)}"></p>
                </div>

                <div class="ui star rating" th:attr="data-rating=${userRate.intValue()}" data-max-rating="5"></div>

                <!--<div class="extra">-->
                    <!--<div class="ui right floated">-->
                       <!--See Trailer-->
                    <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const movieId = [[${movie.id}]];
        const userId = [[${user.id}]];
        /*]]>*/

        const rate = $('.ui.rating');
        rate.rating();
        rate.click(function () {
            const rateValue = rate.rating('get rating');
            const rateObject = {
                rate: rateValue,
                movieId: movieId,
                userId: userId
            };

            $.ajax({
                type: "POST",
                url: "/movies/" + movieId + "/rates",
                data: JSON.stringify(rateObject),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                success: function(data) {
                    const rateField = document.getElementById('rate');
                    if (rateField == null) {
                        $('<p id="rate">' + data.toFixed(1) + '</p>').insertAfter("#imdbRate");
                    } else {
                        document.getElementById('rate').innerHTML = data.toFixed(1);
                    }
                }
            });
        })
    </script>

</th:block>
</html>